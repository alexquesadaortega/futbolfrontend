<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Fútbol 7 - Generador de Equipos</title>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; }
    input, button { margin: 5px; padding: 5px; }
    ul { padding-left: 20px; }
  </style>
</head>
<body>
  <h2>Registro / Login</h2>
  <input id="email" type="email" placeholder="Email">
  <input id="password" type="password" placeholder="Contraseña">
  <button onclick="registerUser()">Registrar</button>
  <button onclick="loginUser()">Login</button>

  <hr>

  <h2>Gestión de jugadores</h2>
  <input id="playerName" placeholder="Nombre jugador">
  <select id="playerPos">
    <option value="Portero">Portero</option>
    <option value="Defensa">Defensa</option>
    <option value="Centrocampista">Centrocampista</option>
    <option value="Delantero">Delantero</option>
  </select>
  <input id="playerMedia" type="number" placeholder="Media" min="0" max="10">
  <button onclick="addPlayer()">Añadir jugador</button>

  <h3>Jugadores añadidos:</h3>
  <ul id="playerList"></ul>

  <hr>

  <h2>Generar equipos balanceados</h2>
  <button onclick="generateBalancedTeamsOptimized()">Generar Equipos</button>
  <div id="teamsOutput"></div>

  <script>
    // Inicializa Supabase
    const supabaseUrl = 'TU_SUPABASE_URL';
    const supabaseKey = 'TU_SUPABASE_ANON_KEY';
    const supabase = Supabase.createClient(supabaseUrl, supabaseKey);

    // Login
    async function loginUser() {
      const email = document.getElementById('email').value;
      const password = document.getElementById('password').value;
      const { data, error } = await supabase.auth.signInWithPassword({ email, password });
      if(error) alert('Error login: ' + error.message);
      else alert('Login correcto: ' + email);
    }

    // Registro
    async function registerUser() {
      const email = document.getElementById('email').value;
      const password = document.getElementById('password').value;
      const { data, error } = await supabase.auth.signUp({ email, password });
      if(error) alert('Error registro: ' + error.message);
      else alert('Registro correcto: ' + email);
    }

    // Gestión de jugadores
    let currentPlayers = [];

    function addPlayer() {
      const name = document.getElementById('playerName').value;
      const pos = document.getElementById('playerPos').value;
      const media = parseFloat(document.getElementById('playerMedia').value);
      if(!name || isNaN(media)) return alert('Nombre y media obligatorios');
      currentPlayers.push({name,pos,media});
      renderPlayers();
    }

    function renderPlayers() {
      const ul = document.getElementById('playerList');
      ul.innerHTML = '';
      currentPlayers.forEach(p => {
        const li = document.createElement('li');
        li.textContent = `${p.name} - ${p.pos} - ${p.media}`;
        ul.appendChild(li);
      });
    }

    // Generar equipos balanceados Fútbol 7
    function generateBalancedTeamsOptimized() {
      if(currentPlayers.length < 14) { alert('Se necesitan al menos 14 jugadores'); return; }

      const porteros = currentPlayers.filter(p => p.pos==='Portero');
      const defensas = currentPlayers.filter(p => p.pos==='Defensa');
      const delanteros = currentPlayers.filter(p => p.pos==='Delantero');
      const otros = currentPlayers.filter(p => !['Portero','Defensa','Delantero'].includes(p.pos));

      if(porteros.length<2 || defensas.length<6 || delanteros.length<2) {
        alert('No hay suficientes jugadores para cumplir posiciones F7');
        return;
      }

      const mediaTeam = team => team.reduce((acc,p)=>acc+p.media,0)/team.length;
      const shuffle = arr => arr.sort(()=>Math.random()-0.5);

      let bestDiff = Infinity, bestTeams = null;

      for(let i=0;i<500;i++) {
        const tPorteros = shuffle([...porteros]);
        const tDefensas = shuffle([...defensas]);
        const tDelanteros = shuffle([...delanteros]);
        const tOtros = shuffle([...otros]);

        let teamA = [], teamB = [];

        teamA.push(tPorteros.shift());
        teamB.push(tPorteros.shift());

        for(let j=0;j<3;j++){ teamA.push(tDefensas.shift()); teamB.push(tDefensas.shift()); }
        teamA.push(tDelanteros.shift()); teamB.push(tDelanteros.shift());

        const remaining = shuffle([...tPorteros,...tDefensas,...tDelanteros,...tOtros]);
        remaining.forEach(p=>{
          if(teamA.length<7 && (teamA.length<=teamB.length || teamB.length===7)) teamA.push(p);
          else if(teamB.length<7) teamB.push(p);
        });

        if(teamA.length!==7 || teamB.length!==7) continue;

        const diff = Math.abs(mediaTeam(teamA)-mediaTeam(teamB));
        if(diff<bestDiff){ bestDiff = diff; bestTeams={teamA,teamB}; if(diff===0) break; }
      }

      if(!bestTeams){ alert('No se pudo generar equipos equilibrados'); return; }

      const output = document.getElementById('teamsOutput');
      output.innerHTML = `<h4>Equipo A (Media: ${mediaTeam(bestTeams.teamA).toFixed(2)})</h4>
                          <ul>${bestTeams.teamA.map(p=>`<li>${p.name} (${p.pos}, ${p.media})</li>`).join('')}</ul>
                          <h4>Equipo B (Media: ${mediaTeam(bestTeams.teamB).toFixed(2)})</h4>
                          <ul>${bestTeams.teamB.map(p=>`<li>${p.name} (${p.pos}, ${p.media})</li>`).join('')}</ul>`;
    }
  </script>
</body>
</html>
