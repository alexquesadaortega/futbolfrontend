<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Fútbol 7 Manager</title>
<style>
  body { font-family: Arial, sans-serif; margin: 20px; }
  input, button { margin: 5px; }
  .team { margin-top: 10px; }
</style>
</head>
<body>

<h1>Fútbol 7 Manager</h1>

<!-- Registro/Login -->
<div>
  <h2>Registro</h2>
  <input type="email" id="registerEmail" placeholder="Email">
  <input type="password" id="registerPassword" placeholder="Contraseña">
  <button onclick="registerUser()">Registrar</button>

  <h2>Login</h2>
  <input type="email" id="loginEmail" placeholder="Email">
  <input type="password" id="loginPassword" placeholder="Contraseña">
  <button onclick="loginUser()">Login</button>
</div>

<hr>

<!-- Añadir jugadores -->
<div>
  <h2>Agregar jugador</h2>
  <input type="text" id="playerName" placeholder="Nombre">
  <select id="playerPosition">
    <option value="portero">Portero</option>
    <option value="defensa">Defensa</option>
    <option value="centrocampista">Centrocampista</option>
    <option value="delantero">Delantero</option>
  </select>
  <input type="number" id="playerSkill" placeholder="Media (1-10)" min="1" max="10">
  <button onclick="addPlayer()">Agregar</button>
</div>

<hr>

<!-- Generar equipos -->
<div>
  <h2>Generar equipos</h2>
  <button onclick="generateTeams()">Generar 2 equipos balanceados</button>
  <div class="team">
    <h3>Equipo A</h3>
    <ul id="teamA"></ul>
  </div>
  <div class="team">
    <h3>Equipo B</h3>
    <ul id="teamB"></ul>
  </div>
</div>

<!-- Supabase CDN -->
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2/dist/supabase.min.js"></script>
<script>
  // Inicializar Supabase
  const supabaseUrl = 'https://vayholflhqoyflbvuusa.supabase.co';
  const supabaseKey = 'TU_ANON_KEY'; // reemplaza con tu clave anónima
  const supabase = supabase.createClient(supabaseUrl, supabaseKey);

  // Lista de jugadores en memoria
  let players = [];

  async function registerUser() {
    const email = document.getElementById('registerEmail').value;
    const password = document.getElementById('registerPassword').value;
    const { data, error } = await supabase.auth.signUp({ email, password });
    if (error) alert(error.message);
    else alert('Usuario registrado correctamente');
  }

  async function loginUser() {
    const email = document.getElementById('loginEmail').value;
    const password = document.getElementById('loginPassword').value;
    const { data, error } = await supabase.auth.signInWithPassword({ email, password });
    if (error) alert(error.message);
    else alert('Login correcto');
  }

  function addPlayer() {
    const name = document.getElementById('playerName').value;
    const position = document.getElementById('playerPosition').value;
    const skill = parseInt(document.getElementById('playerSkill').value);
    if (!name || !position || !skill) return alert('Completa todos los campos');
    players.push({ name, position, skill });
    alert(`Jugador ${name} agregado`);
  }

  function generateTeams() {
    if (players.length < 14) return alert('Necesitas al menos 14 jugadores para 2 equipos');

    // Clonar y ordenar por skill descendente
    let sorted = [...players].sort((a,b) => b.skill - a.skill);
    let teamA = [], teamB = [];

    function pickPosition(pos, count) {
      const pool = sorted.filter(p => p.position === pos);
      for (let i=0; i<count; i++) {
        if (i%2===0) {
          teamA.push(pool[i]);
        } else {
          teamB.push(pool[i]);
        }
        sorted = sorted.filter(p => p !== pool[i]);
      }
    }

    pickPosition('portero', 2);       // 1 por equipo
    pickPosition('defensa', 6);       // 3 por equipo
    pickPosition('delantero', 2);     // 1 por equipo

    // Rellenar con el resto de jugadores (centrocampistas u otros)
    for (let i=0; i<sorted.length; i++) {
      if (teamA.length < 7) teamA.push(sorted[i]);
      else teamB.push(sorted[i]);
    }

    // Mostrar equipos
    const ulA = document.getElementById('teamA');
    const ulB = document.getElementById('teamB');
    ulA.innerHTML = ''; ulB.innerHTML = '';
    teamA.forEach(p => { let li = document.createElement('li'); li.textContent = `${p.name} (${p.position}, ${p.skill})`; ulA.appendChild(li); });
    teamB.forEach(p => { let li = document.createElement('li'); li.textContent = `${p.name} (${p.position}, ${p.skill})`; ulB.appendChild(li); });
  }
</script>
</body>
</html>
