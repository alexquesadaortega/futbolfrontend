<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Fútbol 7 - Generador de equipos</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; }
    input, button { margin: 5px; }
    #equipos { margin-top: 20px; }
    .equipo { margin-bottom: 10px; }
  </style>
</head>
<body>

<h1>Fútbol 7 - Generador de Equipos</h1>

<div id="auth">
  <h2>Registro</h2>
  <input type="email" id="registerEmail" placeholder="Email">
  <input type="password" id="registerPassword" placeholder="Contraseña">
  <button onclick="registerUser()">Registrar</button>

  <h2>Login</h2>
  <input type="email" id="loginEmail" placeholder="Email">
  <input type="password" id="loginPassword" placeholder="Contraseña">
  <button onclick="loginUser()">Iniciar sesión</button>
</div>

<div id="playerSection" style="display:none;">
  <h2>Jugadores</h2>
  <textarea id="playerList" placeholder="Nombre, posición (Portero/Defensa/Medio/Delantero), media, separados por coma" rows="10" cols="50"></textarea>
  <br>
  <button onclick="generateTeams()">Generar Equipos</button>

  <div id="equipos"></div>
</div>

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2/dist/supabase.min.js"></script>
<script>
  // --- Inicialización de Supabase ---
  const supabaseUrl = 'https://vayholflhqoyflbvuusa.supabase.co';
  const supabaseKey = 'TU_SUPABASE_ANON_KEY'; // Pon aquí tu anon key
  const supabase = supabase.createClient(supabaseUrl, supabaseKey);

  // --- Registro ---
  async function registerUser() {
    const email = document.getElementById('registerEmail').value;
    const password = document.getElementById('registerPassword').value;

    const { data, error } = await supabase.auth.signUp({ email, password });
    if (error) {
      alert('Error al registrar: ' + error.message);
    } else {
      alert('Registro exitoso. Confirma tu email si es necesario.');
    }
  }

  // --- Login ---
  async function loginUser() {
    const email = document.getElementById('loginEmail').value;
    const password = document.getElementById('loginPassword').value;

    const { data, error } = await supabase.auth.signInWithPassword({ email, password });
    if (error) {
      alert('Error al iniciar sesión: ' + error.message);
    } else {
      alert('Login exitoso');
      document.getElementById('auth').style.display = 'none';
      document.getElementById('playerSection').style.display = 'block';
    }
  }

  // --- Generación de equipos balanceados ---
  function generateTeams() {
    const raw = document.getElementById('playerList').value.trim();
    if (!raw) return alert('Introduce jugadores');

    const lines = raw.split('\n');
    const players = lines.map(line => {
      const [name, pos, rating] = line.split(',').map(s => s.trim());
      return { name, pos, rating: parseFloat(rating) };
    });

    if (players.length < 14) return alert('Se necesitan al menos 14 jugadores');

    // Separar jugadores por posición
    const porteros = players.filter(p => p.pos.toLowerCase() === 'portero');
    const defensas = players.filter(p => p.pos.toLowerCase() === 'defensa');
    const delanteros = players.filter(p => p.pos.toLowerCase() === 'delantero');
    const medios = players.filter(p => p.pos.toLowerCase() === 'medio');

    if (porteros.length < 2 || defensas.length < 6 || delanteros.length < 2) {
      return alert('No hay suficientes jugadores para cumplir los mínimos por equipo');
    }

    // Ordenar por media descendente
    const sortByRating = arr => arr.sort((a,b) => b.rating - a.rating);

    sortByRating(porteros);
    sortByRating(defensas);
    sortByRating(delanteros);
    sortByRating(medios);

    const equipoA = [];
    const equipoB = [];

    // Añadir mínimos obligatorios
    equipoA.push(porteros[0]);
    equipoB.push(porteros[1]);

    equipoA.push(...defensas.slice(0,3));
    equipoB.push(...defensas.slice(3,6));

    equipoA.push(delanteros[0]);
    equipoB.push(delanteros[1]);

    // Rellenar el resto con medios y defensas extra si quedan
    const remaining = players.filter(p => !equipoA.includes(p) && !equipoB.includes(p));
    sortByRating(remaining);

    while (equipoA.length < 7) equipoA.push(remaining.shift());
    while (equipoB.length < 7) equipoB.push(remaining.shift());

    // Mostrar equipos
    const div = document.getElementById('equipos');
    div.innerHTML = `<div class="equipo"><h3>Equipo A</h3>${equipoA.map(p => `${p.name} (${p.pos}) - ${p.rating}`).join('<br>')}</div>
                     <div class="equipo"><h3>Equipo B</h3>${equipoB.map(p => `${p.name} (${p.pos}) - ${p.rating}`).join('<br>')}</div>`;
  }
</script>

</body>
</html>
